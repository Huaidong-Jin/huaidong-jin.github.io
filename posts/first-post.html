<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日本の金融業界 インタラクティブ分析レポート (Gemini AI搭載版) - Jimmy Kin</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --accent-color: #0369a1;
        }

        [data-theme="dark"] {
            --bg-color: #0f172a;
            --text-color: #f1f5f9;
            --card-bg: #1e293b;
            --border-color: #334155;
            --accent-color: #38bdf8;
        }

        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.7;
            letter-spacing: 0.01em;
        }

        .nav-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
        }
        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px -2px rgba(59, 130, 246, 0.3);
        }
        .nav-button.active {
            background-color: var(--accent-color);
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        .content-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        .content-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
        }

        .flow-diagram-box {
            transition: all 0.3s ease;
            cursor: pointer;
            background-color: var(--card-bg);
            border-color: var(--border-color);
        }
        .flow-diagram-box.active, .flow-diagram-box:hover {
            background-color: #e0f2fe;
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 500px;
            }
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 48rem;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }
        .modal-overlay.visible .modal-content {
            transform: scale(1);
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(0,0,0,.1);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Table of Contents Styles */
        .toc-container {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            margin-bottom: 2rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        .toc-header {
            background: linear-gradient(135deg, var(--accent-color), #0ea5e9);
            color: white;
            padding: 1rem 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .toc-header:hover {
            background: linear-gradient(135deg, #0284c7, #0369a1);
        }
        .toc-content {
            padding: 1.5rem;
            display: none;
        }
        .toc-content.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toc-item {
            display: block;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            text-decoration: none;
            color: var(--text-color);
            background: transparent;
            border: 1px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .toc-item:hover {
            background: var(--accent-color);
            color: white;
            transform: translateX(8px);
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 50%;
            right: 2rem;
            transform: translateY(-50%);
            z-index: 1000;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 3rem;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease;
        }
        .theme-toggle:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        /* Author Bio Styles */
        .author-bio {
            background: linear-gradient(135deg, var(--card-bg), #f8fafc);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin: 3rem 0;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        [data-theme="dark"] .author-bio {
            background: linear-gradient(135deg, var(--card-bg), #1e293b);
        }
        .author-avatar {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            border: 3px solid var(--accent-color);
            margin: 0 auto 1rem;
            background: linear-gradient(135deg, var(--accent-color), #0ea5e9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            font-weight: bold;
        }
        .social-links a {
            transition: all 0.3s ease;
            transform: scale(1);
        }
        .social-links a:hover {
            transform: scale(1.2);
            color: var(--accent-color);
        }

        /* Enhanced Typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Inter', 'Noto Sans JP', serif;
            font-weight: 700;
            line-height: 1.4;
            margin-bottom: 1rem;
        }
        p {
            margin-bottom: 1.25rem;
            line-height: 1.8;
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .theme-toggle {
                right: 1rem;
                width: 2.5rem;
                height: 2.5rem;
            }
            .toc-container {
                margin: 1rem 0;
            }
        }
    </style>
</head>
<body class="antialiased">
    <!-- Application Structure Plan: A top-level navigation system filters a central dashboard. The default 'Overview' view shows macro trends (Transformation, Challenges, Future). Selecting a sector (Banking, Securities, Insurance) updates the dashboard to show a sector-specific snapshot, an interactive HTML/CSS workflow diagram, and a comparable financial performance chart. This structure prioritizes user-driven exploration and direct comparison over the report's linear narrative, making complex information digestible and engaging. -->
    <!-- Visualization & Content Choices: 1. Financial Performance: Interactive Bar Chart (Chart.js) to compare key players across multiple metrics (revenue, profit) selected by the user. Goal: Compare. Justification: Dynamic comparison in a single component. 2. Operational Flow: Interactive Diagram (HTML/Tailwind) with clickable stages (Front/Middle/Back Office) that reveal detailed text. Goal: Organize/Explain. Justification: Visually intuitive and interactive alternative to static text; avoids SVG/Mermaid. 3. Transformation Drivers/Challenges: Interactive Cards (HTML/Tailwind) that expand/show modals on click. Goal: Inform. Justification: Breaks down text, encourages exploration. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <div class="min-h-screen">
        <header class="bg-white shadow-sm sticky top-0 z-40">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
                <!-- Main navigation -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-4">
                        <a href="/" class="text-2xl font-bold hover:text-sky-600 transition" style="color: var(--text-color);">JK</a>
                        <div class="hidden sm:flex space-x-4">
                            <a href="/" class="hover:opacity-75 transition" style="color: var(--text-color);">Home</a>
                            <a href="/about.html" class="hover:opacity-75 transition" style="color: var(--text-color);">About</a>
                            <a href="/posts/first-post.html" class="font-semibold" style="color: var(--accent-color);">Blog</a>
                            <a href="https://github.com/JimmyKin" target="_blank" class="hover:opacity-75 transition" style="color: var(--text-color);">Projects</a>
                        </div>
                    </div>
                </div>
                
                <!-- Page title and content navigation -->
                <div class="text-center">
                    <h1 class="text-3xl font-bold mb-4" style="color: var(--text-color);">日本の金融業界 インタラクティブ分析</h1>
                    
                    <!-- Category navigation -->
                    <nav id="main-nav" class="flex flex-wrap justify-center space-x-2 mb-4">
                        <button data-view="overview" class="nav-button active font-semibold py-2 px-4 rounded-full text-sm sm:text-base">全体像</button>
                        <button data-view="banking" class="nav-button font-semibold py-2 px-4 rounded-full text-sm sm:text-base">銀行</button>
                        <button data-view="securities" class="nav-button font-semibold py-2 px-4 rounded-full text-sm sm:text-base">証券</button>
                        <button data-view="insurance" class="nav-button font-semibold py-2 px-4 rounded-full text-sm sm:text-base">保険</button>
                    </nav>
                    
                    <!-- Date and author -->
                    <div class="text-sm" style="color: var(--text-color); opacity: 0.8;">
                        <span class="date">2025年06月16日</span>
                        <span class="mx-2">•</span>
                        <span class="author">by Jimmy Kin</span>
                    </div>
                </div>
                
                <!-- Table of Contents -->
                <div class="toc-container mt-8 max-w-4xl mx-auto">
                    <div class="toc-header" onclick="toggleTOC()">
                        <div class="flex items-center">
                            <i class="fas fa-list-ul mr-2"></i>
                            目次 (Table of Contents)
                        </div>
                        <i class="fas fa-chevron-down toc-chevron transition-transform duration-300"></i>
                    </div>
                    <div class="toc-content" id="toc-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <a href="#" class="toc-item" onclick="switchView('overview')">
                                <i class="fas fa-chart-pie mr-2 text-blue-500"></i>
                                全体像 - 金融ランドスケープの変革
                            </a>
                            <a href="#" class="toc-item" onclick="switchView('banking')">
                                <i class="fas fa-university mr-2 text-green-500"></i>
                                銀行 - 業界の現状と課題
                            </a>
                            <a href="#" class="toc-item" onclick="switchView('securities')">
                                <i class="fas fa-chart-line mr-2 text-purple-500"></i>
                                証券 - 市場変化への対応
                            </a>
                            <a href="#" class="toc-item" onclick="switchView('insurance')">
                                <i class="fas fa-shield-alt mr-2 text-orange-500"></i>
                                保険 - 人口動態の挑戦
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main id="app-content" class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <!-- Content will be rendered here by JavaScript -->
        </main>
        
        <!-- Author Bio -->
        <div class="author-bio max-w-4xl mx-auto">
            <div class="author-avatar">JK</div>
            <h3 class="text-xl font-bold mb-2" style="color: var(--text-color);">Jimmy Kin</h3>
            <p class="text-base mb-4" style="color: var(--text-color); opacity: 0.8;">
                テクノロジーとイノベーションの熱心な支持者として、金融業界のデジタル変革と市場動向に深い関心を持っています。<br>
                データ分析とインタラクティブな可視化を通じて、複雑な金融トピックを分かりやすく解説することを目指しています。
            </p>
            <div class="social-links flex justify-center space-x-4">
                <a href="https://github.com/JimmyKin" target="_blank" class="text-2xl hover:scale-110 transition-transform" title="GitHub">
                    <i class="fab fa-github"></i>
                </a>
                <a href="#" class="text-2xl hover:scale-110 transition-transform" title="Twitter">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#" class="text-2xl hover:scale-110 transition-transform" title="LinkedIn">
                    <i class="fab fa-linkedin"></i>
                </a>
            </div>
        </div>
    </div>
    
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="toggleTheme()" title="切换主题">
        <i class="fas fa-moon theme-icon" id="theme-icon"></i>
    </button>

    <!-- Modal Structure -->
    <div id="modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-title" class="text-2xl font-bold mb-4 text-slate-800"></h2>
            <div id="modal-body" class="prose max-w-none text-slate-600"></div>
            <button id="modal-close" class="mt-6 bg-sky-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-sky-700 transition">閉じる</button>
        </div>
    </div>

    <script>
const reportData = {
    overview: {
        title: "日本の金融ランドスケープの変革：包括的分析",
        intro: "日本の金融機関は重大な転換点に立っており、ビジネスモデルと業務パラダイムの根本的な再創造を迫る「三重の挑戦」に直面しています。第一に、2024年3月の日本銀行による数十年にわたるデフレ政策からの脱却により金利環境が一変し、収益性向上の機会と、ゼロ金利時代に構築されたポートフォリオの管理に伴う重大なリスクの両方が生まれています。第二に、「2025年の崖」が象徴するデジタルトランスフォーメーション（DX）の必要性が極めて緊急性の高い段階に達しています。第三に、超高齢化と人口減少という深刻な人口動態の変化が、すべてのセクターに不可避の圧力をかけています。",
        sections: [
            { 
                title: "業界変革の主要因",
                type: 'cards',
                items: [
                    { id: 'dx', title: 'DXの緊急性', icon: '💻', content: "経済産業省は、レガシーシステムの近代化に失敗した場合、2025年以降年間最大12兆円の経済損失が発生する可能性があると警告しています。日本の金融機関の56%がハイブリッドクラウド戦略を採用（世界平均38%）し、段階的な近代化を進めていますが、数十年にわたる技術的負債の克服は依然として最大の挑戦です。" },
                    { id: 'fintech', title: 'フィンテックとの連携', icon: '🤝', content: "日本のフィンテック進化は「銀行主導」が特徴で、既存金融機関との協調的エコシステムを形成しています。PayPay、LINE Pay、楽天ペイなどのデジタル決済、ロボアドバイザリー、P2P融資の分野で革新が進む一方、既存のビジネスモデルを根底から覆すような破壊的イノベーションは抑制される傾向があります。" },
                    { id: 'regulation', title: '新たな金融政策と規制', icon: '⚖️', content: "2024年3月の日銀によるマイナス金利政策（NIRP）とイールドカーブコントロール（YCC）の廃止は、数十年来の超金融緩和時代の正式な終了を意味します。金融庁は処方箋的な監督からリスクベース監督へと移行し、フィンテック・イノベーション・ハブや規制サンドボックスを通じてイノベーションを促進しています。" },
                    { id: 'esg', title: 'ESG経営の浸透', icon: '🌿', content: "日本のESGアプローチは、実用的で国家主導の戦略として特徴づけられ、2050年のカーボンニュートラル達成という国家戦略目標と連携しています。2024年2月には世界初のソブリンGX（グリーン・トランスフォーメーション）債が発行され、「グリーン金融」ではなく「トランジション金融」に焦点を当てています。" }
                ]
            },
            {
                title: "業界全体の重要な課題",
                type: 'list',
                intro: '各業界に共通する課題は、従来のプロダクト販売・取引処理中心のビジネスモデルから、顧客中心の関係ベースのアドバイザリーモデルへと転換することの難しさに集約されます。これらの課題は相互に関連し合い、自己強化する負のフィードバックループを形成しています。',
                items: [
                    { title: "銀行: 低金利環境の構造的影響とデジタル競争", content: "マイナス金利政策の解除により一定の改善は見込まれるものの、数十年にわたる超低金利の構造的ダメージは深刻です。楽天銀行や住信SBIネット銀行などのネオバンクが急速に市場シェアを拡大し、PayPayなどのフィンテック決済プラットフォームが重要な顧客接点を奪っています。" },
                    { title: "証券: 手数料収入の消失と投資家行動の変化", content: "ゼロ手数料取引の世界的トレンドにより、従来の取引ベース収益モデルが完全に陳腐化しています。政府の「資産所得倍増プラン」とNISA拡充により新たなデジタルネイティブ投資家が市場に参入していますが、彼らは低コストのパッシブ投資商品を好み、従来の高手数料アドバイスモデルを拒絶しています。" },
                    { title: "保険: 人口動態の不可逆的変化と収益性圧力", content: "超高齢化・人口減少は保険業界にとって根本的な逆風です。生命保険では新規契約者の母数が縮小し、医療・介護関連の支払いが急増しています。同時に、テレマティクス保険やオンデマンド保険を提供するインシュアテック企業が、従来の一律料金・代理店主導モデルに挑戦しています。" }
                ]
            },
            {
                title: "将来展望と戦略的提言",
                type: 'cards',
                items: [
                    { id: 'embedded', title: 'Embedded Finance (組込型金融)', icon: '🧩', content: "金融サービスは日常生活のあらゆる場面に「溶け込む」世界へと向かいます。ECサイトでの商品購入と同時のローン組成、旅行予約サイトでの保険加入が当たり前になります。JAL NEOBANKのような事例が示すように、金融機関はBaaSプロバイダーとして非金融企業に金融機能を提供する「インフラ屋」か、様々なプラットフォーム上で選ばれる「ブランド」かの戦略的選択を迫られます。" },
                    { id: 'personalization', title: 'ハイパー・パーソナライゼーション', icon: '🎯', content: "モルガン・スタンレーの「Next Best Action」プラットフォームのように、AIが膨大な市場・顧客データを分析し、個々の顧客に最適化されたアドバイスをリアルタイムで提供する能力が競争力の源泉となります。これには、サイロ化された顧客データの統合と、顧客の金融生活全体を360度から理解する高度なデータ分析基盤が不可欠です。" },
                    { id: 'ecosystem', title: 'エコシステム・オーケストレーター', icon: '🌐', content: "伝統的な垂直統合型金融機関のモデルは時代遅れになりつつあります。未来のリーディングカンパニーは、フィンテック企業、ITジャイアント、さらにはヘルスケアやリテールといった他業種の企業とも戦略的にパートナーシップを組み、より広範な顧客の課題を解決する「エコシステム」を主導する「オーケストレーター」としての役割を担います。" }
                ]
            }
        ]
    },
    banking: {
        name: "銀行",
        title: "銀行業界の現状と課題",
        intro: "日本の銀行業界は、三菱UFJ、三井住友、みずほの3メガバンクが市場を支配する一方で、根本的な変革圧力に直面しています。国際的な視点では、1990年代初頭に世界の時価総額ランキングを席巻した日本の銀行は、現在では米中の金融機関に大きく後れを取っています。ROE（自己資本利益率）などの収益性指標も国際的な同業他社に劣後しており、構造的な競争力の回復が急務となっています。",
        operationalFlow: {
            title: "銀行の業務フローと課題",
            intro: "日本の銀行業務フローは、数十年にわたって構築された対面・紙ベースのプロセスに深く依存しており、これが現在の競争力低下の根本原因となっています。特に「紙とハンコ」文化は、顧客オンボーディングから融資実行まで、あらゆるプロセスにボトルネックを生み出しています。下の図の各段階をクリックして、業務内容と課題の詳細を確認してください。",
            stages: [
                { id: 'front', name: 'フロントオフィス', content: "【業務内容】預金業務、企業・個人向け貸出業務、国内外為替取引が中核。歴史的に支店での対面サービスが中心で、深い顧客信頼関係を構築してきた。\n【課題】物理的な書類と個人印鑑（ハンコ）への依存が深刻なボトルネック。顧客がオンラインで手続きを開始しても、最終的に支店訪問と紙書類提出が必要となり、顧客体験が分断される。モバイルバンキングアプリへの移行は進んでいるが、複雑な取引では依然として旧来のプロセスに依存。" },
                { id: 'middle', name: 'ミドルオフィス', content: "【業務内容】融資の与信審査、市場・金利リスクの分析・管理、コンプライアンス業務。特に金融庁が義務付ける反社会的勢力（反社）の排除チェックは、日本特有の厳格で複雑なプロセス。\n【課題】低金利環境下で「ミドルリスク」企業への融資拡大を余儀なくされ、信用リスクとオペレーショナルリスクが増大。反社チェックは顧客のライフサイクル全体にわたって継続的に実施する必要があり、膨大な人的リソースを消費。リアルタイムでのリスク監視とコンプライアンス自動化が急務。" },
                { id: 'back', name: 'バックオフィス', content: "【業務内容】大量取引の処理、清算・決済、日次勘定照合、規制当局への各種報告書作成。レガシーシステムの負荷が最も集中する部門。\n【課題】モノリシックなメインフレームシステムが中核にあり、数十年にわたるカスタマイズにより極めて複雑化。紙フォームからの手作業データ入力、システム間の手動照合作業が頻発し、人的エラーとオペレーショナルリスクの温床となっている。システムの柔軟性不足により、新商品の迅速な市場投入や規制変更への対応が困難。" }
            ]
        },
        financials: {
            title: "主要銀行の業績比較 (2023/24年度)",
            intro: "下のボタンで指標を切り替えて、主要な銀行グループの財務パフォーマンスを比較できます。メガバンクは高い収益を上げていますが、その多くは海外事業によるもので、国内事業の収益性には依然として課題が残ります。",
            data: {
                labels: ['三菱UFJ FG', '三井住友FG', 'みずほFG', 'ゆうちょ銀行', '三井住友トラストG'],
                datasets: [
                    { label: '売上収益 (兆円)', data: [11.89, 9.35, 8.74, 2.65, 2.48], backgroundColor: 'rgba(54, 162, 235, 0.6)' },
                    { label: '純利益 (兆円)', data: [1.94, 1.19, 0.89, 0.42, 0.26], backgroundColor: 'rgba(75, 192, 192, 0.6)' },
                    { label: '総資産 (兆円)', data: [403.70, 295.24, 278.67, 233.91, 75.88], backgroundColor: 'rgba(255, 206, 86, 0.6)' },
                    { label: '時価総額 (兆円)', data: [17.19, 11.57, 6.89, 4.93, 2.42], backgroundColor: 'rgba(153, 102, 255, 0.6)' }
                ]
            }
        }
    },
    securities: {
        name: "証券",
        title: "証券業界の現状と課題",
        intro: "証券業界は、野村ホールディングスと大和証券グループが伝統的なリーダーである一方、SBI証券や楽天証券などのオンライン証券が低コスト戦略で市場シェアを急拡大させています。政府の「資産所得倍増プラン」とNISA拡充により個人投資家が急増していますが、ゼロ手数料取引の世界的トレンドにより従来の収益モデルが根本的に問われています。",
        operationalFlow: {
            title: "証券の業務フローと課題",
            intro: "証券業務は、ミリ秒単位のスピードと100%の正確性が要求される高度に技術集約的な業界です。取引の執行から最終決済まで、複数の金融インフラ（日本証券クリアリング機構、証券保管振替機構等）が連携する複雑なエコシステムで運営されています。下の図の各段階をクリックして、業務内容と課題の詳細を確認してください。",
            stages: [
                { id: 'front', name: 'フロントオフィス', content: "【業務内容】グローバル・マーケッツ（GM）部門では株式・債券・デリバティブの売買執行とプロプライエタリー取引、投資銀行部門（IBD）ではM&Aアドバイザリーと新規株式・債券の引受業務、資産運用（AM）部門では機関投資家・個人向けファンド運用を担当。\n【課題】手数料自由化とゼロ手数料取引の普及により、取引量ベースの収益モデルが完全に陳腐化。顧客に対する付加価値の高いアドバイザリーサービスへの転換が生存の条件となっているが、デジタルネイティブな新世代投資家は従来の高コスト・高タッチサービスを拒絶する傾向。" },
                { id: 'middle', name: 'ミドルオフィス', content: "【業務内容】フロントオフィスが執行した取引の詳細確認（約定コンフォメーション）、トレーダーのポジションと市場リスクのリアルタイム監視、規制遵守の確保、市場分析・企業分析を行うリサーチ部門の運営。\n【課題】アルゴリズム取引とHFT（高頻度取引）の普及により、従来の人的監視では対応不可能な取引量とスピードに直面。リアルタイムでのリスク管理システムの高度化と、AI/機械学習を活用した異常取引検知システムの導入が急務。規制環境の急速な変化への対応も重要な課題。" },
                { id: 'back', name: 'バックオフィス', content: "【業務内容】取引執行後の清算・決済プロセス。日本証券クリアリング機構（JSCC）での清算、証券保管振替機構（JASDEC）での最終的な証券・資金の受渡し。現在は取引日から2営業日後（T+2）での決済が標準。\n【課題】国際的なT+1決済への移行圧力が高まる中、既存の決済インフラとシステムの大幅な改修が必要。複数のレガシーシステムにまたがる決済プロセスの統合・自動化により、決済リスクの削減とオペレーショナル効率の向上が求められる。顧客の証券保管と配当・株主総会等のコーポレートアクション処理の効率化も重要。" }
            ]
        },
        financials: {
            title: "主要証券会社の業績比較 (2023/24年度)",
            intro: "下のボタンで指標を切り替えて、主要な証券会社の財務パフォーマンスを比較できます。NISA拡充による個人投資家の増加が追い風となっていますが、大手ネット証券との競争は激化しています。",
            data: {
                labels: ['野村HD', '大和証券グループ'],
                datasets: [
                    { label: '売上収益 (兆円)', data: [1.40, 0.81], backgroundColor: 'rgba(54, 162, 235, 0.6)' },
                    { label: '純利益 (兆円)', data: [0.16, 0.15], backgroundColor: 'rgba(75, 192, 192, 0.6)' },
                    { label: '総資産 (兆円)', data: [49.56, 26.43], backgroundColor: 'rgba(255, 206, 86, 0.6)' },
                    { label: '時価総額 (兆円)', data: [2.73, 1.73], backgroundColor: 'rgba(153, 102, 255, 0.6)' }
                ]
            }
        }
    },
    insurance: {
        name: "保険",
        title: "保険業界の現状と課題",
        intro: "日本の保険業界は、生命保険分野で日本生命・第一生命ホールディングス、損害保険分野で東京海上ホールディングス・MS&AD保険グループが市場を主導しています。しかし、超高齢化・人口減少という不可逆的な人口動態変化により、新規契約者の減少と医療・介護関連支払いの急増という二重の圧力に直面しており、従来の代理店主導・一律料金モデルの根本的な見直しが迫られています。",
        operationalFlow: {
            title: "保険の業務フローと課題",
            intro: "保険業務は、数十年にわたる長期契約の管理と、高度に専門的な保険金支払いプロセスが特徴です。特に損害保険の支払査定では、現地調査や医療専門知識を要する複雑な判定が必要で、多くの手作業と紙ベースのプロセスに依存しています。下の図の各段階をクリックして、業務内容と課題の詳細を確認してください。",
            stages: [
                { id: 'front', name: 'フロントオフィス', content: "【業務内容】営業職員（生保レディ）による対面販売が日本の伝統的モデル。申込者の健康状態・職業・財務状況等を評価してリスクを判定し、保険料を決定する「引受査定」が中核業務。\n【課題】営業職員モデルは人件費が高く、デジタル世代の顧客ニーズとのミスマッチが深刻。オンライン・ダイレクト販売チャネルの強化が急務だが、複雑な保険商品の説明や顧客の理解促進が困難。データ分析とAIを活用した、より精緻で個人化された引受査定への転換が求められるが、従来の画一的なリスク評価モデルからの脱却が課題。" },
                { id: 'middle', name: 'ミドルオフィス', content: "【業務内容】保険金・給付金請求の妥当性を審査する「支払査定」、市場ニーズに応じた新商品開発、膨大な保険料収入を長期運用する資産運用業務。支払査定では医師の診断書確認、事故現場調査、詐欺検知等の高度な専門判断が必要。\n【課題】支払査定プロセスは書類確認・現地調査・医療専門家との連携など、極めて労働集約的で紙ベース。保険金詐欺の巧妙化により、従来の人的判断だけでは限界。AIによる異常検知システムの導入と、デジタル証拠（テレマティクス、IoTセンサー等）の活用が急務。資産運用では低金利環境下での運用難と、ESG投資への対応が重要課題。" },
                { id: 'back', name: 'バックオフィス', content: "【業務内容】保険証券の発行・管理、保険料の定期徴収、契約者情報の生涯管理、承認された保険金・給付金の支払い処理。特に生命保険では数十年にわたる契約管理が必要。\n【課題】保険金支払いプロセスでは、医師の診断書・死亡診断書・事故証明書等の膨大な紙書類の処理が必要で、OCR技術による自動化が進んでいるものの、複雑な手書き文書の読み取り精度に課題。契約者の住所変更・受益者変更等のライフイベント対応も手作業が多く、顧客体験の向上とオペレーショナル効率化の両立が困難。長期契約の特性上、システム移行時のデータ移行リスクも深刻。" }
            ]
        },
        financials: {
            title: "主要保険会社の業績比較 (2023/24年度)",
            intro: "下のボタンで指標を切り替えて、主要な保険会社の財務パフォーマンスを比較できます。人口減少が長期的な逆風となる中、各社は健康増進型保険など新たな商品開発や海外事業で活路を見出そうとしています。",
            data: {
                labels: ['日本生命', '東京海上HD', '第一生命HD'],
                datasets: [
                    { label: '売上収益 (兆円)', data: [7.36, 6.78, 10.03], backgroundColor: 'rgba(54, 162, 235, 0.6)' },
                    { label: '純利益 (兆円)', data: [0.51, 0.87, 0.46], backgroundColor: 'rgba(75, 192, 192, 0.6)' },
                    { label: '総資産 (兆円)', data: [91.95, 31.83, 67.52], backgroundColor: 'rgba(255, 206, 86, 0.6)' },
                    { label: '時価総額 (兆円)', data: [0, 9.81, 3.95], backgroundColor: 'rgba(153, 102, 255, 0.6)' }
                ]
            }
        }
    },
    aiSolutions: {
        banking: {
            front: {
                title: "フロントオフィス向けAI解決策",
                solutions: [
                    {
                        title: "インテリジェント・ドキュメント・プロセッシング（IDP）",
                        content: "AI-OCRと自然言語処理を組み合わせ、手書きの申込書や本人確認書類を自動で読み取り・検証。ハンコの真正性チェックも画像認識AIで自動化し、顧客オンボーディング時間を従来の数日から数時間に短縮。"
                    },
                    {
                        title: "オムニチャネル顧客体験プラットフォーム",
                        content: "顧客がオンラインで開始した手続きを支店で継続できるシームレスな体験を提供。AIが顧客の過去の取引履歴と行動パターンを分析し、最適なチャネルと次のアクションを提案。"
                    },
                    {
                        title: "パーソナライズド・ファイナンシャル・アドバイザリー",
                        content: "顧客の資産状況、ライフステージ、リスク許容度をAIが総合分析し、個別最適化された金融商品とサービスを提案。チャットボットとヒューマンアドバイザーのハイブリッド対応で24時間サポート。"
                    }
                ]
            },
            middle: {
                title: "ミドルオフィス向けAI解決策",
                solutions: [
                    {
                        title: "AI与信スコアリングシステム",
                        content: "従来の財務データに加え、取引履歴、業界動向、ESGスコア等の代替データを機械学習で分析。「ミドルリスク」企業の信用リスクをより精緻に評価し、適正な金利設定を実現。"
                    },
                    {
                        title: "リアルタイム反社チェック自動化",
                        content: "AI搭載の名寄せエンジンが、複数のデータベースを横断して反社会的勢力との関連性を自動スクリーニング。継続的モニタリングにより、既存顧客の状況変化も即座に検知。"
                    },
                    {
                        title: "統合リスク管理ダッシュボード",
                        content: "市場リスク、信用リスク、オペレーショナルリスクを統合的に可視化。AIが異常値を検知し、リスク限度額の超過やポートフォリオの偏りを事前に警告。"
                    }
                ]
            },
            back: {
                title: "バックオフィス向けAI解決策",
                solutions: [
                    {
                        title: "インテリジェント・プロセス・オートメーション（IPA）",
                        content: "RPAとAIを組み合わせ、勘定処理や照合作業を完全自動化。例外処理もAIが学習し、人的介入を最小限に抑制。処理時間を80%短縮し、エラー率を99%削減。"
                    },
                    {
                        title: "予測的システム保守",
                        content: "レガシーシステムの稼働状況をAIが常時監視し、障害発生を事前予測。計画的なメンテナンスにより、システムダウンタイムを最小化し、業務継続性を確保。"
                    },
                    {
                        title: "自動規制報告生成システム",
                        content: "各種規制要件に応じた報告書をAIが自動生成。データの整合性チェックと異常値検知により、報告ミスを防止。規制変更にも迅速に対応。"
                    }
                ]
            }
        },
        securities: {
            front: {
                title: "フロントオフィス向けAI解決策",
                solutions: [
                    {
                        title: "AI投資アドバイザリー・プラットフォーム",
                        content: "顧客の投資目標、リスク許容度、市場環境を総合的に分析し、個別最適化されたポートフォリオを提案。手数料収入に依存しない、アドバイザリーフィー型のビジネスモデルを実現。"
                    },
                    {
                        title: "インテリジェント・トレーディング・システム",
                        content: "市場データ、ニュース、ソーシャルメディアの感情分析をリアルタイムで統合し、最適な取引タイミングと価格を提案。アルゴリズム取引の高度化により、執行コストを削減。"
                    },
                    {
                        title: "次世代ロボアドバイザー",
                        content: "従来の質問票ベースから、行動データと市場環境の変化を継続的に学習する動的リバランシングシステムへ進化。ESG投資やテーマ投資にも対応。"
                    }
                ]
            },
            middle: {
                title: "ミドルオフィス向けAI解決策",
                solutions: [
                    {
                        title: "リアルタイム取引監視システム",
                        content: "HFTやアルゴリズム取引を含む全取引をAIがリアルタイム監視。異常な取引パターンや市場操縦の兆候を即座に検知し、コンプライアンス違反を未然に防止。"
                    },
                    {
                        title: "動的リスク管理システム",
                        content: "ポートフォリオのリスクをリアルタイムで計算し、市場変動に応じて自動的にポジション調整を提案。VaR（バリュー・アット・リスク）の精度向上により、資本効率を最適化。"
                    },
                    {
                        title: "AI投資リサーチ・プラットフォーム",
                        content: "企業の財務データ、業界動向、ESG情報を統合分析し、投資判断をサポート。自然言語生成により、アナリストレポートの初稿を自動作成。"
                    }
                ]
            },
            back: {
                title: "バックオフィス向けAI解決策",
                solutions: [
                    {
                        title: "T+1決済対応自動化システム",
                        content: "決済サイクル短縮に向け、取引照合から決済指図まで全プロセスをAIが自動化。例外処理も機械学習により自動解決し、決済リスクを最小化。"
                    },
                    {
                        title: "インテリジェント・コーポレートアクション処理",
                        content: "配当支払い、株式分割、株主総会等のコーポレートアクションをAIが自動処理。顧客への通知も個別最適化し、参加率向上に貢献。"
                    },
                    {
                        title: "統合決済リスク管理",
                        content: "複数の決済システムを横断してリスクを監視。AIが決済失敗の可能性を事前予測し、代替決済ルートを自動選択。"
                    }
                ]
            }
        },
        insurance: {
            front: {
                title: "フロントオフィス向けAI解決策",
                solutions: [
                    {
                        title: "パーソナライズド保険商品設計",
                        content: "顧客の健康データ、ライフスタイル、リスクプロファイルをAIが分析し、個別最適化された保険商品を設計。テレマティクス保険やウェアラブルデバイス連携により、リアルタイム料金調整を実現。"
                    },
                    {
                        title: "AI引受査定システム",
                        content: "医療データ、職業情報、財務状況を総合的に分析し、リスク評価の精度を向上。画一的な査定から個別リスクベース査定へ転換し、適正な保険料設定を実現。"
                    },
                    {
                        title: "デジタル・インシュアランス・プラットフォーム",
                        content: "オンライン完結型の保険販売プラットフォーム。AIチャットボットが顧客の質問に回答し、最適な保険商品を提案。複雑な商品もインタラクティブな説明で理解促進。"
                    }
                ]
            },
            middle: {
                title: "ミドルオフィス向けAI解決策",
                solutions: [
                    {
                        title: "AI支払査定システム",
                        content: "医療画像解析、事故現場の画像認識、過去の類似事例との比較により、支払査定を自動化。詐欺検知アルゴリズムにより、不正請求を高精度で識別。"
                    },
                    {
                        title: "予測的商品開発プラットフォーム",
                        content: "人口動態、疾病トレンド、気候変動データを分析し、将来の保険ニーズを予測。新商品開発のリードタイムを短縮し、市場投入スピードを向上。"
                    },
                    {
                        title: "ESG統合資産運用システム",
                        content: "ESG要因を組み込んだポートフォリオ最適化により、長期的な運用収益を向上。気候変動リスクも定量化し、保険負債との統合管理を実現。"
                    }
                ]
            },
            back: {
                title: "バックオフィス向けAI解決策",
                solutions: [
                    {
                        title: "インテリジェント・ドキュメント・プロセッシング",
                        content: "診断書、死亡診断書、事故証明書等の複雑な手書き文書をAI-OCRで高精度読み取り。自然言語処理により、文書内容の自動分類と要約を実現。"
                    },
                    {
                        title: "ライフイベント自動対応システム",
                        content: "顧客の住所変更、結婚、出産等のライフイベントをAIが検知し、必要な契約変更手続きを自動提案。顧客満足度向上と事務効率化を両立。"
                    },
                    {
                        title: "レガシーシステム統合プラットフォーム",
                        content: "複数のレガシーシステムをAPIで連携し、データの一元管理を実現。AIがデータ品質を監視し、システム移行時のデータ整合性を保証。"
                    }
                ]
            }
        }
    },
    modalContent: {
        dx: { title: "DXの緊急性", content: "経済産業省が警告する「2025年の崖」は、日本の金融機関にとって存亡に関わる課題です。レガシーシステムの近代化に失敗した場合、2025年以降年間最大12兆円の経済損失が発生する可能性があります。\n\n問題の根源は、数十年にわたって各部門の短期的ニーズに合わせて過度にカスタマイズされたシステム群にあります。これらは現在、複雑で文書化が不十分な「技術的負債」となり、システムを深く理解していた技術者の引退により、維持・改修が極めて困難になっています。\n\n対応策として、日本の金融機関の56%（世界平均38%）がハイブリッドクラウド戦略を採用し、顧客向けフロントエンドの近代化を優先しつつ、基幹システムの移行を慎重に進めています。しかし、この段階的アプローチは、クラウドネイティブなフィンテック企業との競争において、イノベーションスピードで劣位に立つリスクを内包しています。\n\n三菱UFJフィナンシャル・グループはマイクロソフトとの提携によりグループ共通クラウドプラットフォームを構築し、りそなホールディングスは2018年から「りそなグループアプリ」を中心としたデジタルファースト戦略を展開するなど、先進的な取り組みが始まっています。" },
        fintech: { title: "フィンテックとの連携", content: "日本のフィンテックは、既存の金融機関を破壊する「ディスラプター」としてではなく、既存のサービスを補完・強化する「イネーブラー」としての役割が強いのが特徴です。これは、安定性とセキュリティを最優先する日本の金融文化と、消費者保護を重視する規制環境が背景にあります。\n\n金融機関はフィンテック企業と提携することで、自社の信頼性と顧客基盤を活用しつつ、新しい技術を安全に導入できます。一方、フィンテック企業は、提携によって巨大な市場へのアクセスと信用の獲得が可能になります。しかし、この協調的なモデルは、既存のビジネスモデルを根底から覆すような破壊的イノベーションを抑制してしまう可能性も指摘されています。" },
        regulation: { title: "新たな金融政策と規制", content: "2024年3月の日本銀行によるマイナス金利政策（NIRP）とイールドカーブコントロール（YCC）の廃止は、数十年来の超金融緩和時代の正式な終了を意味する歴史的転換点です。\n\nこの長期間の金融緩和は、企業金融の支援と信用収縮の回避には成功しましたが、金融機関の収益性に構造的なダメージを与えました。特に銀行は、利ざやの継続的な圧縮により、より高いリスクを取ることを余儀なくされ、債券ポートフォリオの期間延長や「ミドルリスク」企業への融資拡大により、金利リスクと信用リスクの両方への露出を増大させました。\n\n規制面では、金融庁が処方箋的なチェックリスト型監督から、前向きでリスクベースの監督フレームワークへと移行しています。イノベーション促進のため、規制サンドボックスやフィンテック・イノベーション・ハブを設立し、規制当局とイノベーターの間の正式な対話チャネルを構築しています。\n\n政府レベルでは、「資産所得倍増プラン」が重要な政策推進力となっています。家計資産を低利回りの銀行預金から「貯蓄から投資へ」とシフトさせることを目的とし、NISA制度の大幅拡充と恒久化、個人型確定拠出年金（iDeCo）の改革を通じて実現を図っています。" },
        esg: { title: "ESG経営の浸透", content: "日本におけるESGは、欧米のような政治的な対立とは一線を画し、国の長期的な経済競争力を高めるための「産業政策」として位置づけられています。政府は2050年のカーボンニュートラル達成を目標に掲げ、GX（グリーン・トランスフォーメーション）債を発行するなど、金融システムを通じて産業界の脱炭素化を後押ししています。\n\nこの動きを決定づけたのが、世界最大の年金基金であるGPIFの存在です。GPIFが早期からESG投資を本格化させたことで、市場全体のESGへの取り組みが加速しました。企業の気候関連リスクの情報開示を求めるコーポレートガバナンス・コードの改訂も、この流れを後押ししています。" },
        embedded: { title: "Embedded Finance (組込型金融)", content: "金融の未来像の一つが、金融サービスが日常生活のあらゆる場面に「溶け込む」世界です。例えば、ECサイトで商品購入と同時にローンを組んだり、旅行予約サイトで保険に加入したりすることが当たり前になります。このトレンドにより、金融機関は、BaaSプロバイダーとして非金融企業に金融機能を提供する「インフラ屋」になるか、あるいは様々なプラットフォーム上で顧客に選ばれる「ブランド」となるかの戦略的選択を迫られます。" },
        personalization: { title: "ハイパー・パーソナライゼーション", content: "これからの金融サービスでは、顧客を大まかなセグメントで分けるのではなく、データとAIを用いて一人ひとりの状況や目標に合わせた最適なアドバイスや商品をリアルタイムで提供する「ハイパー・パーソナライゼーション」が競争力の源泉となります。これを実現するには、サイロ化された顧客データを統合し、顧客の金融生活全体を360度から理解する高度なデータ分析基盤が不可欠です。" },
        ecosystem: { title: "エコシステム・オーケストレーター", content: "伝統的な、自前主義の垂直統合型金融機関のモデルは時代遅れになりつつあります。未来のリーディングカンパニーは、自社で全ての機能を開発するのではなく、フィンテック企業、ITジャイアント、さらにはヘルスケアやリテールといった他業種の企業とも戦略的にパートナーシップを組み、より広範な顧客の課題を解決する「エコシステム」を主導する「オーケストレーター」としての役割を担うことになるでしょう。" },
    }
};

document.addEventListener('DOMContentLoaded', () => {
    const appContent = document.getElementById('app-content');
    const mainNav = document.getElementById('main-nav');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const modalClose = document.getElementById('modal-close');
    let financialChart = null;
    let currentFlowStage = 'front';
    let currentViewName = 'overview';

    function formatText(text) {
        return text.replace(/\n/g, '<br>');
    }

    function showModal(contentId) {
        const content = reportData.modalContent[contentId];
        if (content) {
            modalTitle.textContent = content.title;
            modalBody.innerHTML = formatText(content.content);
            modal.classList.add('visible');
        }
    }
    
    function hideModal() {
        modal.classList.remove('visible');
    }
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal || e.target === modalClose) {
            hideModal();
        }
    });

    function createOverviewView() {
        const viewData = reportData.overview;
        let html = `<div class="fade-in">
            <h2 class="text-3xl font-bold tracking-tight sm:text-4xl" style="color: var(--text-color);">${viewData.title}</h2>
            <p class="mt-4 text-lg leading-8" style="color: var(--text-color); opacity: 0.8;">${viewData.intro}</p>`;

        viewData.sections.forEach(section => {
            html += `<div class="mt-12">
                <h3 class="text-2xl font-bold text-slate-800">${section.title}</h3>`;
            if (section.intro) {
                html += `<p class="mt-2 text-slate-600">${section.intro}</p>`;
            }

            if (section.type === 'cards') {
                html += `<div class="mt-6 grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-4">`;
                section.items.forEach(item => {
                    html += `<div class="content-card bg-white rounded-xl shadow-md p-6" data-modal-id="${item.id}">
                        <div class="flex items-center justify-center h-12 w-12 rounded-full bg-sky-100 text-2xl">${item.icon}</div>
                        <h4 class="mt-4 text-lg font-semibold text-slate-900">${item.title}</h4>
                        <p class="mt-2 text-sm text-slate-600">${item.content}</p>
                    </div>`;
                });
                html += `</div>`;
            } else if (section.type === 'list') {
                html += `<div class="mt-6 space-y-4">`;
                section.items.forEach(item => {
                    html += `<div class="bg-white rounded-lg shadow-sm p-4">
                        <h4 class="font-semibold text-slate-800">${item.title}</h4>
                        <p class="text-sm text-slate-600">${item.content}</p>
                    </div>`;
                });
                html += `</div>`;
            }
            html += `</div>`;
        });
        html += `</div>`;
        return html;
    }
    
    function createFinancialChart(data) {
        const ctx = document.getElementById('financialChartCanvas').getContext('2d');
        if (financialChart) {
            financialChart.destroy();
        }
        
        financialChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.labels,
                datasets: [data.datasets[0]]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y + ' 兆円';
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: data.datasets[0].label
                        }
                    },
                    x: {
                        ticks: {
                            callback: function(value, index, ticks) {
                                const label = this.getLabelForValue(value);
                                return label.length > 10 ? label.substring(0, 10) + '...' : label;
                            }
                        }
                    }
                }
            }
        });
        
        const metricButtons = document.getElementById('metric-selector');
        metricButtons.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const metricIndex = e.target.dataset.metric;
                const newDataset = data.datasets[metricIndex];
                
                financialChart.data.datasets[0] = newDataset;
                financialChart.options.scales.y.title.text = newDataset.label;
                financialChart.update();
                
                metricButtons.querySelectorAll('button').forEach(btn => btn.classList.remove('bg-sky-600', 'text-white'));
                e.target.classList.add('bg-sky-600', 'text-white');
            }
        });
    }

    function updateAiSolutions(viewName, stageId) {
        const aiSolutionsContent = document.getElementById('ai-solutions-content');
        if (!aiSolutionsContent || !reportData.aiSolutions[viewName] || !reportData.aiSolutions[viewName][stageId]) {
            return;
        }

        const solutionData = reportData.aiSolutions[viewName][stageId];
        let html = `<h5 class="text-md font-semibold text-slate-800 mb-3">${solutionData.title}</h5>`;
        
        solutionData.solutions.forEach((solution, index) => {
            html += `
                <div class="mb-4 ${index > 0 ? 'border-t border-slate-200 pt-4' : ''}">
                    <h6 class="text-sm font-semibold text-slate-800 mb-2">解決策${index + 1}: ${solution.title}</h6>
                    <p class="text-sm text-slate-600">${solution.content}</p>
                </div>
            `;
        });

        aiSolutionsContent.innerHTML = html;
    }

    function createSectorView(viewName) {
        currentViewName = viewName;
        currentFlowStage = 'front'; // Reset to default stage
        const viewData = reportData[viewName];
        let html = `<div class="fade-in">
            <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">${viewData.title}</h2>
            <p class="mt-4 text-lg leading-8 text-slate-600">${viewData.intro}</p>`;
            
        if(viewData.operationalFlow) {
            const flowData = viewData.operationalFlow;
            html += `<div class="mt-12">
                <h3 class="text-2xl font-bold text-slate-800">${flowData.title}</h3>
                <p class="mt-2 text-slate-600">${flowData.intro}</p>
                <div class="mt-6 flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4">`;
            
            flowData.stages.forEach((stage, index) => {
                html += `<div class="flow-diagram-box w-full md:w-1/3 border-2 border-slate-300 rounded-lg p-4 text-center" data-stage="${stage.id}">
                    <h4 class="font-semibold text-slate-900">${stage.name}</h4>
                </div>`;
                if (index < flowData.stages.length - 1) {
                    html += `<div class="text-3xl text-slate-400 transform rotate-90 md:rotate-0">→</div>`;
                }
            });

            html += `</div>
            <div id="flow-detail" class="mt-4 bg-sky-50 p-6 rounded-lg min-h-[100px] text-slate-700 whitespace-pre-wrap">
                ${formatText(flowData.stages[0].content)}
            </div>
            
            <div id="ai-solutions-section" class="mt-6 bg-gradient-to-r from-sky-50 to-indigo-50 p-6 rounded-xl shadow-md">
                <h4 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                    <span class="text-2xl mr-2">✨</span>
                    AIによる解決策の提案
                </h4>
                <div id="ai-solutions-content" class="prose prose-sm max-w-none text-slate-700">
                    <!-- Content will be populated based on selected stage -->
                </div>
            </div>
            </div>`;
        }
        
        if(viewData.financials) {
            const finData = viewData.financials;
            html += `<div class="mt-12 bg-white p-6 rounded-xl shadow-lg">
                <h3 class="text-2xl font-bold text-slate-800">${finData.title}</h3>
                <p class="mt-2 text-slate-600">${finData.intro}</p>
                <div id="metric-selector" class="my-4 flex flex-wrap gap-2">`;
            finData.data.datasets.forEach((dataset, index) => {
                const isActive = index === 0 ? 'bg-sky-600 text-white' : 'bg-slate-200 text-slate-700';
                html += `<button data-metric="${index}" class="${isActive} font-semibold py-2 px-4 rounded-full text-sm transition hover:bg-sky-500 hover:text-white">${dataset.label.split(' ')[0]}</button>`;
            });
            
            html +=`</div>
                <div class="chart-container">
                    <canvas id="financialChartCanvas"></canvas>
                </div>
            </div>`;
        }

        html += `</div>`;
        return html;
    }
    
    function renderView(viewName) {
        let contentHtml = '';
        if (viewName === 'overview') {
            currentViewName = 'overview';
            contentHtml = createOverviewView();
        } else {
            contentHtml = createSectorView(viewName);
        }
        appContent.innerHTML = contentHtml;
        
        // Add event listeners for the newly created content
        if (viewName === 'overview') {
            appContent.querySelectorAll('.content-card').forEach(card => {
                card.addEventListener('click', () => showModal(card.dataset.modalId));
            });
        } else {
            if(reportData[viewName].financials) {
                createFinancialChart(reportData[viewName].financials.data);
            }
            if(reportData[viewName].operationalFlow) {
                const flowBoxes = appContent.querySelectorAll('.flow-diagram-box');
                const flowDetail = appContent.querySelector('#flow-detail');
                
                flowBoxes[0].classList.add('active');
                
                // Initialize AI solutions for the first stage
                updateAiSolutions(viewName, currentFlowStage);

                flowBoxes.forEach(box => {
                    box.addEventListener('click', () => {
                        flowBoxes.forEach(b => b.classList.remove('active'));
                        box.classList.add('active');
                        currentFlowStage = box.dataset.stage;
                        const stageData = reportData[viewName].operationalFlow.stages.find(s => s.id === currentFlowStage);
                        flowDetail.innerHTML = formatText(stageData.content);
                        
                        // Update AI solutions for the selected stage
                        updateAiSolutions(viewName, currentFlowStage);
                    });
                });
            }
        }
    }

    mainNav.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            const viewName = e.target.dataset.view;
            if (viewName) {
                mainNav.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                renderView(viewName);
            }
        }
    });

    // Initial render
    renderView('overview');
});

// Theme Toggle Function
function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    const themeIcon = document.getElementById('theme-icon');
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    // Update icon
    if (newTheme === 'dark') {
        themeIcon.className = 'fas fa-sun theme-icon';
    } else {
        themeIcon.className = 'fas fa-moon theme-icon';
    }
}

// Table of Contents Toggle
function toggleTOC() {
    const tocContent = document.getElementById('toc-content');
    const chevron = document.querySelector('.toc-chevron');
    
    if (tocContent.classList.contains('show')) {
        tocContent.classList.remove('show');
        chevron.style.transform = 'rotate(0deg)';
    } else {
        tocContent.classList.add('show');
        chevron.style.transform = 'rotate(180deg)';
    }
}

// Switch View Function for TOC
function switchView(viewName) {
    // Close TOC
    const tocContent = document.getElementById('toc-content');
    const chevron = document.querySelector('.toc-chevron');
    tocContent.classList.remove('show');
    chevron.style.transform = 'rotate(0deg)';
    
    // Switch to the selected view
    const mainNav = document.getElementById('main-nav');
    const targetButton = mainNav.querySelector(`[data-view="${viewName}"]`);
    if (targetButton) {
        mainNav.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
        targetButton.classList.add('active');
        renderView(viewName);
        
        // Smooth scroll to content
        document.getElementById('app-content').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
    }
}

// Initialize theme on page load
document.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    const themeIcon = document.getElementById('theme-icon');
    
    document.documentElement.setAttribute('data-theme', savedTheme);
    
    if (savedTheme === 'dark') {
        themeIcon.className = 'fas fa-sun theme-icon';
    } else {
        themeIcon.className = 'fas fa-moon theme-icon';
    }
});

// Enhanced scroll-to-top functionality
let scrollTimeout;
window.addEventListener('scroll', function() {
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(function() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const themeToggle = document.querySelector('.theme-toggle');
        
        if (scrollTop > 200) {
            themeToggle.style.opacity = '0.8';
        } else {
            themeToggle.style.opacity = '1';
        }
    }, 100);
});
    </script>
</body>
</html> 